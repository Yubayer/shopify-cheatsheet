{% liquid
  assign id = section.id
  assign collectionList = section.blocks | where: 'type', 'collection-list'
%}

<style>
  #shopify-section-{{ id }} {
    box-sizing: border-box;
    margin-top: {{ section.settings.margin_top | append: 'px' }};
    margin-bottom: {{ section.settings.margin_bottom | append: 'px' }};
    padding-top: {{ section.settings.padding_top | append: 'px' }};
    padding-bottom: {{ section.settings.padding_bottom | append: 'px' }};
  }

  @media(max-width: 768px) {
    #shopify-section-{{ id }} {
      margin-top: {{ section.settings.margin_top_m | append: 'px' }};
      margin-bottom: {{ section.settings.margin_bottom_m | append: 'px' }};
      padding-top: {{ section.settings.padding_top_m | append: 'px' }};
      padding-bottom: {{ section.settings.padding_bottom_m | append: 'px' }};
    }
  }

  .heading-wrapper-{{ id }} {
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin-block: 45px;
  }
  .heading-wrapper-{{ id }} h2{
    color: #000;
    text-align: center;
    font-size: 32px;
    line-height: normal;
    text-transform: capitalize;
    margin: 0;
  }
  .heading-wrapper-{{ id }} p{
    color: #000;
    text-align: center;
    font-size: 16px;
    line-height: normal;
    text-transform: capitalize;
    margin: 0;
  }

  .collection-list-{{ id }} {
    display: grid;
    grid-template-columns: repeat(6,1fr);
    grid-column-gap: 11px;
  }
  .list-item-{{ id }} {
    height: 37px;
    line-height: 37px;
    display: block;
    border: 1px solid #F5D8CC;
    background-color: transparent;
    box-sizing: border-box;
    color: #000;
    text-align: center;
    font-size: 14px;
    font-style: normal;
    font-weight: 400;
    text-transform: capitalize;
    cursor: pointer;
    text-decoration: none;
  }
  .list-item-{{ id }}.active{
    background-color: #e5cec1;
  }

  @media(max-width: 560px) {
    .collection-list-{{ id }} {
      display: flex;
      flex-wrap: nowrap;
      gap: 10px;
      flex-direction: row;
      overflow-x: auto;
      overflow-y: hidden;
    }
    .collection-list-{{ id }}::-webkit-scrollbar{
      visibility: hidden;
      display: none;
    }
    .list-item-{{ id }} {
      min-width: 40%;
    }
  }
</style>

<div class="sec-{{ id }}">
  <div class="{% unless section.settings.full_width %}page-width{% endunless %}">
    <div class="heading-wrapper-{{ id }} {% if section.settings.heading == blank and section.settings.heading_text == blank %}hidden{% endif %}">
      {% unless section.settings.heading == blank %}
        <h2>
          {% if section.settings.heading == 'Products' %}
            Shop All
          {% else %}
            {{ section.settings.heading }}
          {% endif %}
        </h2>
      {% endunless %}
      {% unless section.settings.heading_text == blank %}
        <p>{{ section.settings.heading_text }}</p>
      {% endunless %}
    </div>
    <div class="collection-list-{{ id }}" id="scrollContainer">
      {% for block in collectionList %}
        <a
          class="list-item-{{ id }} {% if collection.handle == block.settings.collection.handle %}active{% endif %}"
          href="{{ block.settings.collection.url }}"
          data-index="{{ forloop.index0 }}"
        >
          {{- block.settings.collection.title -}}
        </a>
      {% endfor %}
    </div>
    <div class="wrapper-{{ id }}">
      <div class="img-wrapper-{{ id }}"></div>
    </div>
  </div>
</div>
{% if collectionList.size > 0 %}
  <script>
    document.addEventListener('DOMContentLoaded', e => {
      const scrollContainer = document.getElementById('scrollContainer');

      let touchstartX = 0;
      let touchendX = 0;

      function handleGesture(left=140) {
        let dir = 1
        touchendX < touchstartX ? dir=1 : dir=-1
        scrollContainer.scrollBy({
          left: left*dir,
          behavior: 'smooth'
        });
      }

      scrollContainer.addEventListener('touchstart', e => {
        touchstartX = e.changedTouches[0].screenX;
      }, false);

      scrollContainer.addEventListener('touchend', e => {
        touchendX = e.changedTouches[0].screenX;
        handleGesture();
      }, false);

      let collectionListItems = document.querySelectorAll(".list-item-{{ id }}")
      collectionListItems.forEach(item => {
        if(item.classList.contains('active')) {
          let index = parseInt(item.dataset.index)
          handleGesture(index*140*-1)
        }
      })
    });
  </script>
{% endif %}
{% schema %}
{
  "name": "New Collection Products",
  "templates": ["collection"],
  "settings": [
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Full Width Section",
      "default": true
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading"
    },
    {
      "type": "text",
      "id": "heading_text",
      "label": "Text"
    },
    {
      "type": "header",
      "content": "Section Spacing Desktop"
    },
    {
      "type": "range",
      "id": "margin_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Margin Top",
      "default": 24
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Margin Bottom",
      "default": 24
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Top",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 0
    },
    {
      "type": "header",
      "content": "Section Spacing Mobile"
    },
    {
      "type": "range",
      "id": "margin_top_m",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Margin Top",
      "default": 24
    },
    {
      "type": "range",
      "id": "margin_bottom_m",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Margin Bottom",
      "default": 24
    },
    {
      "type": "range",
      "id": "padding_top_m",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Top",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom_m",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "collection-list",
      "name": "Collection List",
      "limit": 6,
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "New Collection Products"
    }
  ]
}
{% endschema %}
